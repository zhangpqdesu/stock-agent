# PDF导出功能说明

## 功能概述

本系统已成功集成了CSV转PDF的功能到Streamlit前端，用户可以直接在Web界面中将股票分析报告转换为PDF格式。

## 功能特点

### 1. 环境检测
- 自动检测wkhtmltopdf是否安装
- 自动下载所需的中文字体（思源黑体）
- 提供详细的环境状态反馈

### 2. PDF导出方式

#### 方式一：侧边栏批量导出
- 在左侧边栏的"报告导出"部分
- 从下拉列表中选择要导出的报告
- 点击"📄 转换为PDF"按钮
- 支持查看文件大小信息

#### 方式二：当前报告快捷导出
- 当查看缓存报告时，在主界面会显示快捷导出按钮
- 点击"📄 导出当前报告为PDF"可直接导出正在查看的报告

### 3. PDF文件管理
- 显示已生成的PDF文件列表
- 按生成时间倒序排列
- 显示文件大小和生成时间
- 提供"📂 打开PDF目录"按钮，可直接在文件管理器中查看PDF文件

## 使用前准备

### 1. 安装wkhtmltopdf
1. 访问：https://wkhtmltopdf.org/downloads.html
2. 下载适合您操作系统的版本
3. 安装后确保添加到系统PATH环境变量

### 2. 字体文件
- 系统会自动下载思源黑体字体
- 如果下载失败，请检查网络连接

## PDF文件特点

### 1. 文件格式
- 文件名格式：`股票分析报告_{股票代码}_{日期}_{时间}.pdf`
- 例如：`股票分析报告_000001.SZ_20250729_143022.pdf`

### 2. 内容格式
- 包含完整的股票分析报告内容
- 报告元数据（生成时间、使用的AI模型等）
- 重要免责声明
- 中文字体优化，确保显示效果

### 3. 保存位置
- 所有PDF文件保存在`pdf_reports`目录中
- 可通过界面中的"打开PDF目录"按钮快速访问

## 错误处理

### 常见问题及解决方案

1. **PDF转换失败：wkhtmltopdf未找到**
   - 确保已正确安装wkhtmltopdf
   - 检查PATH环境变量配置

2. **字体下载失败**
   - 检查网络连接
   - 可能需要重启应用以重新下载

3. **缓存文件读取失败**
   - 确保缓存文件未被其他程序占用
   - 检查文件编码格式

## 技术实现

### 主要组件
- `converter.py`: 核心PDF转换逻辑
- `app.py`: Streamlit前端集成
- `cache_manager.py`: 缓存文件管理

### 关键技术
- wkhtmltopdf: PDF生成引擎
- pdfkit: Python封装库
- 思源黑体: 中文字体支持
- HTML/CSS: 报告样式设计

## 更新记录

### v1.0 (2025-07-29)
- ✅ 集成PDF导出功能到Streamlit前端
- ✅ 添加环境检测和字体自动下载
- ✅ 支持两种导出方式（批量和快捷）
- ✅ 添加PDF文件管理界面
- ✅ 改进错误处理和用户反馈
- ✅ 添加PDF目录快速访问功能
